<%- include('../../views/partials/header') %>

<main class="container mt-4">
  <h1 class="text-center mb-4">Add New Classification</h1>
  
  <% if (message) { %>
    <div class="alert alert-<%= message.type || 'info' %>">
      <%- message.text %>
    </div>
  <% } %>
  
  <% if (errors && errors.length > 0) { %>
    <div class="alert alert-danger">
      <ul class="mb-0">
        <% errors.forEach(error => { %>
          <li><%= error.msg %></li>
        <% }) %>
      </ul>
    </div>
  <% } %>
  
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="card">
        <div class="card-body">
          <form action="/inv/add-classification" method="post" id="classificationForm">
            <div class="mb-3">
              <label for="classification_name" class="form-label">Classification Name</label>
              <input 
                type="text" 
                class="form-control <%= errors && errors.some(e => e.param === 'classification_name') ? 'is-invalid' : '' %>" 
                id="classification_name" 
                name="classification_name" 
                required
                value="<%= classification_name || '' %>"
                pattern="^[a-zA-Z0-9]+$"
                title="Classification name must not contain spaces or special characters"
              >
              <div class="form-text">Enter a name for the new classification (no spaces or special characters).</div>
              <div class="invalid-feedback">
                Please provide a valid classification name with no spaces or special characters.
              </div>
            </div>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button type="submit" class="btn btn-primary me-md-2">Add Classification</button>
              <a href="/inv" class="btn btn-secondary">Cancel</a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</main>

<%- include('../../views/partials/footer') %>

<script>
document.getElementById('classificationForm').addEventListener('submit', function(event) {
  const classificationInput = document.getElementById('classification_name');
  const regex = /^[a-zA-Z0-9]+$/;
  
  if (!regex.test(classificationInput.value)) {
    event.preventDefault();
    classificationInput.classList.add('is-invalid');
    classificationInput.focus();
    return false;
  }
  
  return true;
});

// Remove invalid class when user starts typing
const classificationInput = document.getElementById('classification_name');
if (classificationInput) {
  classificationInput.addEventListener('input', function() {
    if (this.classList.contains('is-invalid')) {
      this.classList.remove('is-invalid');
    }
  });
}
</script>
